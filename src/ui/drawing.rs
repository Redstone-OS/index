//! # Drawing
//!
//! Funções básicas de desenho.

/// Desenha um retângulo preenchido
pub fn fill_rect(buf: &mut [u32], buf_w: u32, x: u32, y: u32, w: u32, h: u32, color: u32) {
    for dy in 0..h {
        for dx in 0..w {
            let px = x + dx;
            let py = y + dy;
            if px < buf_w {
                let idx = (py * buf_w + px) as usize;
                if idx < buf.len() {
                    buf[idx] = color;
                }
            }
        }
    }
}

/// Desenha uma linha horizontal
pub fn hline(buf: &mut [u32], buf_w: u32, x: u32, y: u32, w: u32, color: u32) {
    for dx in 0..w {
        let px = x + dx;
        let idx = (y * buf_w + px) as usize;
        if idx < buf.len() {
            buf[idx] = color;
        }
    }
}

/// Desenha um caractere simples (bitmap 8x8)
pub fn draw_char(buf: &mut [u32], buf_w: u32, x: u32, y: u32, c: char, color: u32) {
    let bitmap = get_char_bitmap(c);

    for row in 0..8 {
        let bits = bitmap[row];
        for col in 0..8 {
            if (bits >> (7 - col)) & 1 == 1 {
                let px = x + col;
                let py = y + row as u32;
                let idx = (py * buf_w + px) as usize;
                if idx < buf.len() {
                    buf[idx] = color;
                }
            }
        }
    }
}

/// Desenha uma string
pub fn draw_text(buf: &mut [u32], buf_w: u32, x: u32, y: u32, text: &str, color: u32) {
    let mut cx = x;
    for c in text.chars() {
        draw_char(buf, buf_w, cx, y, c, color);
        cx += 8;
    }
}

/// Obtém bitmap de um caractere (fonte básica 8x8)
fn get_char_bitmap(c: char) -> [u8; 8] {
    // Fonte minimalista - apenas caracteres básicos
    match c {
        ' ' => [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
        '/' => [0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x00],
        '.' => [0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00],
        '-' => [0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00],
        '_' => [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF],
        ':' => [0x00, 0x18, 0x18, 0x00, 0x00, 0x18, 0x18, 0x00],
        '<' => [0x08, 0x10, 0x20, 0x40, 0x20, 0x10, 0x08, 0x00],
        '>' => [0x20, 0x10, 0x08, 0x04, 0x08, 0x10, 0x20, 0x00],
        '[' => [0x3C, 0x20, 0x20, 0x20, 0x20, 0x20, 0x3C, 0x00],
        ']' => [0x3C, 0x04, 0x04, 0x04, 0x04, 0x04, 0x3C, 0x00],
        '(' => [0x08, 0x10, 0x20, 0x20, 0x20, 0x10, 0x08, 0x00],
        ')' => [0x20, 0x10, 0x08, 0x08, 0x08, 0x10, 0x20, 0x00],
        '0' => [0x3C, 0x46, 0x4A, 0x52, 0x62, 0x3C, 0x00, 0x00],
        '1' => [0x18, 0x28, 0x08, 0x08, 0x08, 0x3E, 0x00, 0x00],
        '2' => [0x3C, 0x42, 0x04, 0x18, 0x20, 0x7E, 0x00, 0x00],
        '3' => [0x3C, 0x42, 0x0C, 0x02, 0x42, 0x3C, 0x00, 0x00],
        '4' => [0x0C, 0x14, 0x24, 0x7E, 0x04, 0x04, 0x00, 0x00],
        '5' => [0x7E, 0x40, 0x7C, 0x02, 0x42, 0x3C, 0x00, 0x00],
        '6' => [0x1C, 0x20, 0x7C, 0x42, 0x42, 0x3C, 0x00, 0x00],
        '7' => [0x7E, 0x02, 0x04, 0x08, 0x10, 0x10, 0x00, 0x00],
        '8' => [0x3C, 0x42, 0x3C, 0x42, 0x42, 0x3C, 0x00, 0x00],
        '9' => [0x3C, 0x42, 0x3E, 0x02, 0x04, 0x38, 0x00, 0x00],
        'a' | 'A' => [0x3C, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x00, 0x00],
        'b' | 'B' => [0x7C, 0x42, 0x7C, 0x42, 0x42, 0x7C, 0x00, 0x00],
        'c' | 'C' => [0x3C, 0x42, 0x40, 0x40, 0x42, 0x3C, 0x00, 0x00],
        'd' | 'D' => [0x7C, 0x42, 0x42, 0x42, 0x42, 0x7C, 0x00, 0x00],
        'e' | 'E' => [0x7E, 0x40, 0x7C, 0x40, 0x40, 0x7E, 0x00, 0x00],
        'f' | 'F' => [0x7E, 0x40, 0x7C, 0x40, 0x40, 0x40, 0x00, 0x00],
        'g' | 'G' => [0x3C, 0x42, 0x40, 0x4E, 0x42, 0x3C, 0x00, 0x00],
        'h' | 'H' => [0x42, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x00, 0x00],
        'i' | 'I' => [0x3E, 0x08, 0x08, 0x08, 0x08, 0x3E, 0x00, 0x00],
        'j' | 'J' => [0x1E, 0x04, 0x04, 0x04, 0x44, 0x38, 0x00, 0x00],
        'k' | 'K' => [0x42, 0x44, 0x78, 0x44, 0x42, 0x42, 0x00, 0x00],
        'l' | 'L' => [0x40, 0x40, 0x40, 0x40, 0x40, 0x7E, 0x00, 0x00],
        'm' | 'M' => [0x42, 0x66, 0x5A, 0x42, 0x42, 0x42, 0x00, 0x00],
        'n' | 'N' => [0x42, 0x62, 0x52, 0x4A, 0x46, 0x42, 0x00, 0x00],
        'o' | 'O' => [0x3C, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00, 0x00],
        'p' | 'P' => [0x7C, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x00, 0x00],
        'q' | 'Q' => [0x3C, 0x42, 0x42, 0x4A, 0x44, 0x3A, 0x00, 0x00],
        'r' | 'R' => [0x7C, 0x42, 0x7C, 0x48, 0x44, 0x42, 0x00, 0x00],
        's' | 'S' => [0x3C, 0x40, 0x3C, 0x02, 0x42, 0x3C, 0x00, 0x00],
        't' | 'T' => [0x7E, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00, 0x00],
        'u' | 'U' => [0x42, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00, 0x00],
        'v' | 'V' => [0x42, 0x42, 0x42, 0x24, 0x24, 0x18, 0x00, 0x00],
        'w' | 'W' => [0x42, 0x42, 0x42, 0x5A, 0x66, 0x42, 0x00, 0x00],
        'x' | 'X' => [0x42, 0x24, 0x18, 0x18, 0x24, 0x42, 0x00, 0x00],
        'y' | 'Y' => [0x42, 0x24, 0x18, 0x10, 0x10, 0x10, 0x00, 0x00],
        'z' | 'Z' => [0x7E, 0x04, 0x08, 0x10, 0x20, 0x7E, 0x00, 0x00],
        _ => [0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
    }
}
